---
title: "Historical MLB Salary Analaysis"
author: "Sean Guglietti"
date: "2025-10-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(dplyr)
```

### Retrieving data

```{r salaryRetrieval, include = TRUE}
url <- "https://raw.githubusercontent.com/SeanG347/LahmanBaseballDatabase/refs/heads/main/Salaries.csv"
salary.data <- read.csv(url, header = TRUE, sep = ",")
salary.df <- data.frame(salary.data)
salary.df <- salary.df[salary.df$yearID > 1953, ]

mean_salary_by_year <- salary.df %>%
  group_by(yearID) %>%
  summarise(mean_salary = mean(salary))


ggplot(data = mean_salary_by_year, aes(x=yearID, y = mean_salary)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(
    xlab = "Year",
    ylab = "Average Salary"
  )

yearly_salary_by_team_df <- salary.df %>% 
  group_by(teamID, yearID) %>%
  summarise(teamSalary = sum(salary), .groups = "drop")
```

```{r battingRetrieval, include = TRUE}
url <- "https://raw.githubusercontent.com/SeanG347/LahmanBaseballDatabase/refs/heads/main/Batting.csv"
batting.data <- read.csv(url, header=TRUE,sep=",")
batting.df <- data.frame(batting.data)

batting.df = batting.df[batting.df$AB > 0, ]

batting.df$AVG = batting.df$H/batting.df$AB
batting.df$SLG = with(batting.df, ((H-X2B-X3B-HR)+2*X2B + 3*X3B + 4*HR)/AB)
batting.df$PA = with(batting.df, AB + BB + HBP + SF)
batting.df$OBP = with(batting.df, (H+BB+HBP)/PA)
batting.df$OPS = with(batting.df, OBP + SLG)

head(batting.df)
summary(batting.df)


mean_ba_by_year = batting.df %>%
  group_by(yearID) %>%
  summarise(mean_ba = mean(AVG))

ggplot(data = mean_ba_by_year, aes(x=yearID, y = mean_ba)) + 
  geom_point(color = "red") +
  labs(
    x = "Year",
    y = "League Average Batting Average",
    title = "League Average AVG by year"
  )



modern.batting.df <- batting.df[batting.df$yearID > 1953,]

mean_ba_by_year_modern = modern.batting.df %>% 
  group_by(yearID) %>% 
  summarise(mean_avg = mean(AVG))

mean_ops_by_year = modern.batting.df %>% 
  group_by(yearID) %>%
  summarise(mean_ops = mean(OPS))

means <- data.frame(year = mean_ops_by_year$yearID,
                    OPS = mean_ops_by_year$mean_ops,
                    AVG = mean_ba_by_year_modern$mean_avg)

ggplot(data = means) +
  geom_point(color = "red", data = means, aes(x=year,y=AVG)) +
  geom_point(color = "blue", data = means, aes(x=year,y=OPS))+
  labs(
    x = "Year",
    y = "League Average OPS",
    title = "League Average OPS. AVG by year"
  )

```


### Notes
  - I will from now on only use the "modern.batting.df" dataframe, which contains entries only after 1953, as that is when sacrifices were tracked, which allows the plate appearance stat to be accurate. 
  - Hypotheses:
    - Salary has a bearing on team success ($H_0$: $\beta_{salary}$ = 0, $H_1$: $\beta_{salary}$ > 0)
      - Note: Winning percentage will be used as the response to operationalize "team success"
    - Player height has bearing on hitting success: ($H_0$: $\beta_{height}$ = 0, $H_1$: $\beta_{weight}$ > 0)
      - Note: OPS will be used as the response to operationalize "hitting success"


```{r SalaryHypothesis}
url <- "https://raw.githubusercontent.com/SeanG347/LahmanBaseballDatabase/refs/heads/main/Teams.csv"
team.data <- read.csv(url, header=TRUE,sep=",")
team.df <- data.frame(team.data)

# Reducing data to only include the modern era (since sacrifices were tracked)
team.df <- team.df[team.df$yearID > 1953,]

# Making a new feature for the team's win percentage, this is to operationalize team success.
team.df$winPerc = team.df$W/(team.df$W+team.df$L)

# Making a new dataframe with only the relevant features
relFeatures = c('yearID','teamID','G','W','L','winPerc')
team.df.small <- team.df[relFeatures]
head(team.df.small)

# Sorting dataframe by winPerc
team.df.small[order(team.df.small$winPerc, decreasing = TRUE),]



```


```{r Aggregating}
# This chunk will group and summarise the salaries of the individual players into a dataframe containing the total salaries of the teams per year.

team.salary.df <- salary.df %>%
  group_by(teamID, yearID) %>%
  summarise(teamSalary = sum(salary, na.rm=TRUE)) %>%
  ungroup()

team.df.small <- team.df.small %>%
  left_join(team.salary.df, by = c("teamID","yearID"))

team.df.small
```